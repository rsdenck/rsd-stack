# RT-11 — Garantia de Build Determinístico

Este relatório documenta as ações tomadas para garantir que o processo de build da **RSD-Stack** seja previsível, repetível e seguro contra alterações silenciosas em dependências externas.

## 1. Fixação de Imagens Base (SHA256 Digest)

Todas as imagens externas utilizadas como base (Parent Images) ou em estágios de build (Builders) foram fixadas utilizando o digest SHA256. Isso impede que atualizações automáticas de tags (como `latest` ou `12-slim`) alterem o comportamento da stack sem uma mudança explícita no código.

| Componente | Imagem Original | Imagem Fixada |
| :--- | :--- | :--- |
| **Base Runtime** | `debian:12-slim` | `debian:12-slim@sha256:7f46571...` |
| **Elasticsearch** | `elasticsearch:8.13.4` | `elasticsearch:8.13.4@sha256:9825c85...` |
| **Logstash** | `logstash:8.13.4` | `logstash:8.13.4@sha256:5664177...` |
| **Kibana** | `kibana:8.13.4` | `kibana:8.13.4@sha256:6e01a97...` |
| **Elastiflow** | `debian:12-slim` | `debian:12-slim@sha256:7f46571...` |

## 2. Ordem de Build Previsível

Foi implementado o script `ops/build-all.sh`, que orquestra a sequência correta de construção das imagens.

- **Fase 1:** Construção da `rsd/base-runtime:12` (Base de todos os serviços).
- **Fase 2:** Construção paralela/sequencial dos serviços (`els`, `lgs`, `kbn`, `wzh`, `efw`) utilizando a base recém-criada.

## 3. Validação Automática

O script `ops/validate-build.sh` foi atualizado para incluir verificações rigorosas:
- **Check de Digest:** Garante que nenhum `Dockerfile` utiliza imagens externas sem `@sha256`.
- **Check de Versão:** Impede o uso da tag `latest`.
- **Contrato RT-09:** Mantém a validação de Tini, Paths `/opt/rsd` e Usuário não-root.

## 4. Status Final
- **Determinismo:** 100% (Imagens externas fixadas).
- **Reprodutibilidade:** Alta (Scripts de build padronizados).
- **Segurança:** Reforçada (Validação de integridade na origem).

---
*Gerado em 2026-01-15 por Arquiteto de Plataforma / SRE.*
